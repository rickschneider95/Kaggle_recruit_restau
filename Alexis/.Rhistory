}
n_d(try,"noon")
data_air
data_air %>% group_by(id,visit_date) %>% summarise(total = n())
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
data_air %>% group_by(id,visit_date) %>% summarise(total = n())
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
data_air
rdayweek_transf <- function(data){
one_h <- data
one_h$day_of_the_week_reserve <- as.factor(one_h$day_of_the_week_visit)
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data
one_h$day_of_the_week_visit <- as.factor(one_h$day_of_the_week_visit)
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- rdayweek_transf(try)
try <- vdayweek_transf(try)
try
data_air
data_air
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- rdayweek_transf(try)
try <- vdayweek_transf(try)
try <- lat_transf(try)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
one_h <- data_air
dataset <- read.csv("data/complete_data.csv")
data_air <- dataset %>% filter(str_detect(id, "^air"))
data_air
one_h <- data_air
one_h <- data_air
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
try <- data_air
try <- try %>% cbind(one_h)
try
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
dataset <- read.csv("data/complete_data.csv")
data_air <- dataset %>% filter(str_detect(id, "^air"))
data_hpg <- data %>% filter(str_detect(id, "^hpg"))
data_hpg <- data %>% filter(str_detect(id, "^hpg"))
data_hpg <- data set%>% filter(str_detect(id, "^hpg"))
data_hpg <- dataset %>% filter(str_detect(id, "^hpg"))
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
vtime_transf <- function(data){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3)) #put visit_time as factor, and only extract the hour for the time: the first two components of the time: ex 19:00:00 will be converted to 19
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data <- data %>%
mutate(day_visit = day(dmy(visit_date)), #extract visit day from date
day_reserve = day(dmy(reserve_date)),  #extract reserve day from date
month_visit = month(dmy(visit_date)),   #extract visit month from date
month_reserve = month(dmy(reserve_date)), #extract reserve month from date
year_visit = year(dmy(visit_date)), #extract visit year from date
year_reserve = year(dmy(visit_date)), #extract reserve year from date
latency_days=ifelse(is.na(reserve_date),0,as.numeric(as.Date(visit_date)-as.Date(reserve_date))), #days between reservation vs visit. if no reservation then will be 0
latency_people=ifelse(is.na(reserve_visitors),0,visitors-reserve_visitors)) #difference in the number of people from the party between reservation vs visit. if no reservation then will be 0
vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
datal <- dataset %>%
mutate(day_visit = day(dmy(visit_date)), #extract visit day from date
day_reserve = day(dmy(reserve_date)),  #extract reserve day from date
month_visit = month(dmy(visit_date)),   #extract visit month from date
month_reserve = month(dmy(reserve_date)), #extract reserve month from date
year_visit = year(dmy(visit_date)), #extract visit year from date
year_reserve = year(dmy(visit_date)), #extract reserve year from date
latency_days=ifelse(is.na(reserve_date),0,as.numeric(as.Date(visit_date)-as.Date(reserve_date))), #days between reservation vs visit. if no reservation then will be 0
latency_people=ifelse(is.na(reserve_visitors),0,visitors-reserve_visitors)) #difference in the number of people from the party between reservation vs visit. if no reservation then will be 0
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
dataset <- read.csv("data/complete_data.csv")
data_air <- dataset %>% filter(str_detect(id, "^air"))
vtime_transf <- function(data){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
ryear_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 0, end = 4))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vyear_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 0, end = 4))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
basic_area_transf <- function(data){
one_h <- data
one_h <- data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = as.factor(case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name))) ## This is just an error in the data set
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
rdayweek_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
dn_transf <- function(data){
one_h <- data %>%
mutate(d_n = as.integer(str_sub(as.character(visit_time),
start = 0,
end = 3)
)) %>%
mutate(d_n = as.factor(case_when(d_n >= 4 & d_n <= 16 ~ "day",
TRUE ~ "night")))
one_h <- one_h %>% select(d_n)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
area_transf <- function(data){
one_h <- data
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- rdayweek_transf(try)
try <- vdayweek_transf(try)
try <- dn_transf(try)
dn_transf <- function(data){
one_h <- data %>%
select(visit_time) %>%
mutate(visit_time = as.integer(str_sub(as.character(visit_time),
start = 0,
end = 3)
)) %>%
mutate(visit_time = as.factor(case_when(visit_time >= 4 & visit_time <= 16 ~ "day",
TRUE ~ "night")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- dn_transf(try)
try
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- rdayweek_transf(try)
try <- vdayweek_transf(try)
try <- dn_transf(try)
data_Air
data_air
try-data_air
try <- data_air
try <- vdayweek_transf(try)
try
try <- rdayweek_transf(try)
try
try <- dn_transf(try)
try <- data_air
try <- dn_transf(try)
try
try <- vdayweek_transf(try)
try
try <- rdayweek_transf(try)
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- dn_transf(try)
try <- vdayweek_transf(try)
try <- rdayweek_transf(try)
try
## Obsolete bin :
# try <- basic_area_transf(try)
## To debug bin:
# try <- lat_transf(try)
# try <- lon_transf(try) Doesn't work, i'll look more into it later on but this fct is kinda bs tbh
data_air
data_air %>%
mutate(latency_days = ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))
data_air %>%
mutate(latency_days = ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date)))) %>% View()
one_h <- data_air
one_h <- one_h %>%
mutate(latency_days = as.factor(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days)
one_h
one_h <- one_hot(as.data.table(one_h))
try <- data_air
try <- try %>% cbind(one_h)
try
trytry <- read.csv("data/data_1h_xgb.csv")
trytry
colSums(is.na.data.frame(trytry))
nrow(trytry)
sum(is.na(data$day_of_the_week_reserve))
sum(is.na(data_air$day_of_the_week_reserve))
info <- read.csv("data/store_id_relation.csv")
info
info %>% select(air_store_id)
info <- info %>% select(air_store_id)
data_air
info <- info %>% select(air_store_id) %>% rename(id = air_store_id)
info <- read.csv("data/store_id_relation.csv")
info <- info %>% select(air_store_id) %>% rename(id = air_store_id)
data_air %>% inner_join(info, by = "id")
test <- data_air %>% inner_join(info, by = "id")
test
sum(is.na(test))
sum(is.na(dataset))
data_air <- dataset %>% filter(str_detect(id, "^air"))
sum(is.na(data_air))
one_h <- data_air
one_h <- one_h %>%
mutate(latency_days = as.factor(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days)
one_h
one_h <- data_air
one_h <- one_h %>%
select(latency_days) %>%
mutate(latency_days = as.factor(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date)))))
one_h <- one_h %>%
mutate(latency_days = as.factor(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days)
one_h
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days)
one_h <- data_air
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days)
one_h <- data_air
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 7 ~ "casual",
latency_days > 7 & latency_days <= 30 ~ "fancy",
TRUE ~ "very fancy")))
one_h
one_h <- data_air
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(try = as.factor(case_when(latency_days >= 0 & latency_days <= 7 ~ "casual",
latency_days > 7 & latency_days <= 30 ~ "fancy",
TRUE ~ "very fancy")))
one_h
one_h <- data_air
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 7 ~ "casual",
latency_days > 7 & latency_days <= 30 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
try <- data_air
try <- try %>% cbind(one_h)
try
latency_transf <- function(data){
one_h <- data
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 7 ~ "casual",
latency_days > 7 & latency_days <= 30 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
latency_transf <- function(data){
one_h <- data
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 7 ~ "casual",
latency_days > 7 & latency_days <= 30 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
latency_transf <- function(data){
one_h <- data
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 7 ~ "casual",
latency_days > 7 & latency_days <= 30 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
dataset <- read.csv("data/complete_data.csv")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
dataset <- read.csv("data/complete_data.csv")
colSums(is.na(dataset))
