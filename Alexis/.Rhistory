visit_date == ymd("20160503") |
visit_date == ymd("20160504") |
visit_date == ymd("20160505") |
visit_date == ymd("20170429") |
visit_date == ymd("20170503") |
visit_date == ymd("20170504") |
visit_date == ymd("20170505") ~ 1,
TRUE ~ 0)) %>%
select(goldenweek) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- goldw_transf(try)
try
try <- air_data
goldd_transf <- function(data){
one_h <- data %>%
mutate(visit_date = ymd(visit_date)) %>%
mutate(goldendays = case_when(visit_date == ymd("20160429") |
visit_date == ymd("20160503") |
visit_date == ymd("20160504") |
visit_date == ymd("20160505") |
visit_date == ymd("20170429") |
visit_date == ymd("20170503") |
visit_date == ymd("20170504") |
visit_date == ymd("20170505") ~ 1,
TRUE ~ 0)) %>%
select(goldenweek) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- goldd_transf(try)
goldd_transf <- function(data){
one_h <- data %>%
mutate(visit_date = ymd(visit_date)) %>%
mutate(goldendays = case_when(visit_date == ymd("20160429") |
visit_date == ymd("20160503") |
visit_date == ymd("20160504") |
visit_date == ymd("20160505") |
visit_date == ymd("20170429") |
visit_date == ymd("20170503") |
visit_date == ymd("20170504") |
visit_date == ymd("20170505") ~ 1,
TRUE ~ 0)) %>%
select(goldendays) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- goldd_transf(try)
try
levels(as.factor(air_data$genre_name))
air_store_info <- read.csv("data/air_store_info.csv")
air_visit_data <- read.csv("data/air_visit_data.csv")
air_data <- full_join(air_visit_data,air_store_info, by = "air_store_id") %>%
rename(id = air_store_id) %>%
rename(genre_name = air_genre_name) %>%
rename(area_name = air_area_name)
summary(is.na(air_data)) # No NA's.
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
air_data <- left_join(air_data,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(air_data)) # No NA's.
levels(as.factor(air_data$genre_name))
air_visit_data
levels(as.factor(air_store_info$genre_name))
levels(as.factor(air_store_info))
levels(as.factor(air_store_info$air_genre_name))
levels(as.factor(air_store_info$air_genre_name))
# HAVENT WORKED ON IT YET
barrest_transf <- function(data){
one_h <- data %>%
select(genre_name) %>%
mutate(genre_name = case_when(genre_name == "Asian" |
genre_name == "Okonomiyaki/Monja/Teppanyaki" |
genre_name == "Japanese food" |
genre_name == "Western food" |
genre_name == "Italian/French" |
genre_name == "International cuisine" |
genre_name == "Yakiniku/Korean food" |
genre_name == "Izakaya" |
genre_name == "Creative cuisine" ~ "Restaurant",
genre_name == "Dining bar" |
genre_name == "Bar/Cocktail" |
genre_name == "Karaoke/Party" |
genre_name == "Cafe/Sweets" ~ "Bar",
TRUE ~ as.character(genre_name))) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- barrest_transf(try)
try
air_data
wknd_transf <- function(data){
one_h <- data %>%
mutate(wknd = case_when(day_of_the_week_visit == "Friday" |
day_of_the_week_visit == "Saturday" |
day_of_the_week_visit == "Sunday" ~ 1,
TRUE ~ 0)) %>%
select(wknd) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- wknd_transf(try)
try
try <- air_data
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- air_data
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- wknd_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- wknd_transf(try)
try <- bme_vmonth_transf(try)
wknd_transf <- function(data){
one_h <- data %>%
mutate(wknd = case_when(day_of_the_week_visit == "Friday" |
day_of_the_week_visit == "Saturday" |
day_of_the_week_visit == "Sunday" ~ "weekend",
TRUE ~ "weekday")) %>%
select(wknd) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- wknd_transf
try <- wknd_transf(try)
try <- air_data
try <- wknd_transf(try)
try
wknd_transf <- function(data){
one_h <- data %>%
mutate(wknd = case_when(day_of_the_week_visit == "Friday" |
day_of_the_week_visit == "Saturday" |
day_of_the_week_visit == "Sunday" ~ "weekend",
TRUE ~ "weekday")) %>%
select(wknd) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
# Transf functions on basic vars:
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try
# HAVENT WORKED ON IT YET
barrest_transf <- function(data){
one_h <- data %>%
select(genre_name) %>%
mutate(genre_name = case_when(genre_name == "Asian" |
genre_name == "Okonomiyaki/Monja/Teppanyaki" |
genre_name == "Japanese food" |
genre_name == "Western food" |
genre_name == "Italian/French" |
genre_name == "International cuisine" |
genre_name == "Yakiniku/Korean food" |
genre_name == "Izakaya" |
genre_name == "Creative cuisine" ~ "Restaurant",
genre_name == "Dining bar" |
genre_name == "Bar/Cocktail" |
genre_name == "Karaoke/Party" |
genre_name == "Cafe/Sweets" ~ "Bar",
TRUE ~ "Else")) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- wknd_transf(try)
one_h <- data %>%
mutate(wknd = case_when(day_of_the_week_visit == "Friday" |
day_of_the_week_visit == "Saturday" |
day_of_the_week_visit == "Sunday" ~ "weekend",
TRUE ~ "weekday"))
one_h <- air_data %>%
mutate(wknd = case_when(day_of_the_week_visit == "Friday" |
day_of_the_week_visit == "Saturday" |
day_of_the_week_visit == "Sunday" ~ "weekend",
TRUE ~ "weekday"))
levels(as.factor(one_h$wknd))
air_store_info <- read.csv("data/air_store_info.csv")
air_visit_data <- read.csv("data/air_visit_data.csv")
air_data <- full_join(air_visit_data,air_store_info, by = "air_store_id") %>%
rename(id = air_store_id) %>%
rename(genre_name = air_genre_name) %>%
rename(area_name = air_area_name)
summary(is.na(air_data)) # No NA's.
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
air_data <- left_join(air_data,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(air_data)) # No NA's.
barrest_transf <- function(data){
one_h <- data %>%
select(genre_name) %>%
mutate(genre_name = case_when(genre_name == "Asian" |
genre_name == "Okonomiyaki/Monja/Teppanyaki" |
genre_name == "Japanese food" |
genre_name == "Western food" |
genre_name == "Italian/French" |
genre_name == "International cuisine" |
genre_name == "Yakiniku/Korean food" |
genre_name == "Izakaya" |
genre_name == "Creative cuisine" ~ "Restaurant",
genre_name == "Dining bar" |
genre_name == "Bar/Cocktail" |
genre_name == "Karaoke/Party" |
genre_name == "Cafe/Sweets" ~ "Bar",
TRUE ~ "Else")) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try
try
try <- try[,-c(4:9)]
#CHANFE LAST NUMBER EVERY NEW VERSION:
write.csv(try, "data/data_1h_xgb_CORRECT_4.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_CORRECT_4.csv")
trytry
# Checks :
n_occur <- data.frame(table(trytry$id,trytry$visit_date))
n_occur[n_occur$Freq > 1,]  # No duplicates
summary(is.na(trytry)) # No NA's
try
air_data
one_h <- air_data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
map(str_sub, start = 0, end = 8)
levels(as.factor(one_h$area_name))
levels(as.factor(air_store_info$air_area_name))
one_h <- air_data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = str_sub(area_name, start = 0, end = 8))
levels(as.factor(one_h$area_name))
one_h <- air_data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = str_sub(area_name, start = 0, end = 8)) %>%
mutate(wealth = case_when(area_name == "Tōkyō-to" ~ "High",
area_name == "Shizuoka" | area_name == "Hyōgo-ke" | area_name == "Ōsaka-fu" ~ "Middle/High",
area_name == "Niigata-" | area_name == "Miyagi-k" | area_name == "Hokkaidō" ~ "Middle",
area_name == "Fukuoka-" ~ "Middle/Low",
TRUE ~ "Low"))
one_h
wealth_transf <- function(data){
one_h <- air_data %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = str_sub(area_name, start = 0, end = 8)) %>%
mutate(wealth = case_when(area_name == "Tōkyō-to" ~ "High",
area_name == "Shizuoka" | area_name == "Hyōgo-ke" | area_name == "Ōsaka-fu" ~ "Middle/High",
area_name == "Niigata-" | area_name == "Miyagi-k" | area_name == "Hokkaidō" ~ "Middle",
area_name == "Fukuoka-" ~ "Middle/Low",
TRUE ~ "Low")) %>%
select(wealth) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- wealth_transf(try)
try
dataset %>%
mutate(day_visit = day(dmy(visit_date))
datal <- dataset %>%
datal <- dataset %>%
mutate(day_visit = day(dmy(visit_date)))
dataset
datal <- dataset %>%
mutate(day_visit = day(ymd(visit_date)))
datal <- dataset %>%
mutate(day_visit = day(visit_date))
date_info
days <- c(1:365)
{
days <- c(1:365)
}
days <- c(1:365)
days
date_info
517 -365
days <- c(1:365)
days <- days %>% rbind(c(1:152))
days
days <- c(1:365) + c(1:152)
days
days <- c(1:365)
days <- days %>% rbind(c(1:152))
days <- c(1:365:1:152)
days
days <- c(1:365;1:152)
days <- c(1:365,1:152)
days
days <- data.frame(1:365,1:152)
days <- data.frame(c(1:365,1:152))
days
date_info <- date_info %>% cbind(days)
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
days <- c(1:365,1:152)
dates <- date_info %>% cbind(days)
dates
date_info %>% cbind(days) %>%
select(visit_date,days)
one_h <- air_data %>% left_join(dates, by = "visit_date")
one_h
summary(is.na(one_h))
one_h
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- air_data %>%
left_join(dates, by = "visit_date")
}
try
try <- nth_day_trasnf(try)
try
try
try <- air_data
try <- wealth_transf(try)
try
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
try <- nth_day_trasnf(try)
try
wealth_transf <- function(data){
one_h <- air_data %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = str_sub(area_name, start = 0, end = 8)) %>%
mutate(wealth = case_when(area_name == "Tōkyō-to" ~ "High",
area_name == "Shizuoka" | area_name == "Hyōgo-ke" | area_name == "Ōsaka-fu" ~ "Middle/High",
area_name == "Niigata-" | area_name == "Miyagi-k" | area_name == "Hokkaidō" ~ "Middle",
area_name == "Fukuoka-" ~ "Middle/Low",
TRUE ~ "Low")) %>%
select(wealth) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
try <- wealth_transf(try)
try <- air_data
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try <- nth_day_trasnf(try)
try
try
try <- try[,-c(4:9)]
try <- try[,-c(4:9)]
#CHANGE LAST NUMBER EVERY NEW VERSION:
write.csv(try, "data/data_1h_xgb_CORRECT_5.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_CORRECT_5.csv")
trytry
try <- air_data
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
# try <- lat_transf(try)
# try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try <- nth_day_trasnf(try)
try
try
try <- try[,-c(3:4)]
try
try <- air_data
# Transf functions on basic vars:
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
# try <- lat_transf(try)
# try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try <- nth_day_trasnf(try)
try
try <- try[,-c(4:5)]
try
try <- try[,-c(6:7)]
#CHANGE LAST NUMBER EVERY NEW VERSION:
write.csv(try, "data/data_1h_xgb_CORRECT_6.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_CORRECT_6.csv")
trytry
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
library(purrr)
