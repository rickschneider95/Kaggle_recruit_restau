vignette("ggplot2-specs")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(air_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "blue") +
# scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "blue") +
# scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n())
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total, fill = hpg_area_name)) +
geom_boxplot() +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
mutate(hpg_area_name = str_sub(hpg_area_name, 0, 8)) %>%
ggplot(aes(hpg_area_name, hpg_genre_name)) +
geom_count(colour = "blue") +
theme(legend.position = "bottom", axis.text.x  = element_text(angle=45, hjust=1, vjust=0.9)) +
labs(y = "Genre", x = "Area", title = "Contingency table")
hpg %>%
mutate(hpg_area_name = substr(hpg_area_name, 0, 8)) %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total, fill = hpg_area_name)) +
geom_boxplot() +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
mutate(hpg_area_name = substr(hpg_area_name, 0, 8)) %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot(fill = hpg_area_name) +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
mutate(hpg_area_name = substr(hpg_area_name, 0, 8)) %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "blue") +
scale_y_log10() +
coord_flip() +
labs(x = "Genre", y = "Number of restaurants per area")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, n, FUN = mean), n)) +
geom_boxplot() +
geom_jitter(color = "red") +
scale_y_log10() +
coord_flip() +
labs(x = "hpg genre", y = "Cases per hpg area")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n())
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, n, FUN = mean), n)) +
geom_boxplot()
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
ggplot(aes(reorder(hpg_genre_name, total, FUN = mean), total)) +
geom_boxplot() +
geom_jitter(color = "red") +
scale_y_log10() +
coord_flip() +
labs(x = "hpg genre", y = "Cases per hpg area")
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) == 0
sum(hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) == 0)
min(hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()))
hpg %>%
group_by(hpg_genre_name, hpg_area_name) %>%
summarise(total = n()) %>%
arrange(total) %>%
head()
leaflet(hpg) %>%
addTiles() %>%
addProviderTiles("CartoDB.Positron") %>%
addMarkers(~longitude, ~latitude,
popup = ~hpg_store_id, label = ~hpg_genre_name,
clusterOptions = markerClusterOptions())
med_coord_hpg <- hpg %>%
summarise_at(vars(longitude:latitude), median)
med_coord_hpg
med_coord_hpg <- hpg_store %>%
summarise_at(vars(longitude:latitude), median)
med_coord_hpg
med_coord_hpg <- test %>%
summarise_at(vars(longitude:latitude), median)
test <- hpg_store %>%
mutate(hpg_genre_name = as.factor(hpg_genre_name),
hpg_area_name = as.factor(hpg_area_name))
med_coord_hpg <- test %>%
summarise_at(vars(longitude:latitude), median)
med_coord_hpg
med_coord_hpg <- hpg %>%
summarise_at(vars(longitude:latitude), median)
med_coord_hpg
hpg_coords <- hpg %>%
select(longitude, latitude)
hpg_coords
hpg_store$dist <- istCosine(hpg_coords, med_coord_hpg)/1e3
hpg_store$dist <- distCosine(hpg_coords, med_coord_hpg)/1e3
hpg_store <- read.csv("data/hpg_store_info.csv")
test$dist <- distCosine(hpg_coords, med_coord_hpg)/1e3
test
test <- test %>%
mutate(dist_group = as.integer(case_when(
dist < 80 ~ 1,
dist < 300 ~ 2,
dist < 500 ~ 3,
dist < 750 ~ 4,
TRUE ~ 5))) %>%
left_join(hpg_count, by = "hpg_area_name") %>%
separate(hpg_area_name, c("prefecture"), sep = " ", remove = FALSE)
test_count <- hpg_store %>%
group_by(hpg_area_name) %>%
summarise(hpg_count = n())
test <- test %>%
mutate(dist_group = as.integer(case_when(
dist < 80 ~ 1,
dist < 300 ~ 2,
dist < 500 ~ 3,
dist < 750 ~ 4,
TRUE ~ 5))) %>%
left_join(hpg_count, by = "hpg_area_name") %>%
separate(hpg_area_name, c("prefecture"), sep = " ", remove = FALSE) # Seperating areas in function of their distance to "center"
dist < 80 ~ 1,
dist < 80 ~ 1,
test
test <- test %>%
mutate(dist_group = as.integer(case_when(
dist < 80 ~ 1,
dist < 300 ~ 2,
dist < 500 ~ 3,
dist < 750 ~ 4,
TRUE ~ 5))) %>%
left_join(test_count, by = "hpg_area_name") %>%
separate(hpg_area_name, c("prefecture"), sep = " ", remove = FALSE)
test
p2 <- test %>%
ggplot(aes(dist)) +
geom_histogram(bins = 30, fill = "red") +
geom_vline(xintercept = c(80, 300, 500, 750)) +
labs(x = "Linear distance [km]")
dist < 80 ~ 1,
test <- test %>%
mutate(dist_group = as.integer(case_when(dist < 80 ~ 1, dist < 300 ~ 2, dist < 500 ~ 3, dist < 750 ~ 4, TRUE ~ 5))) %>%
left_join(test_count, by = "hpg_area_name") %>%
separate(hpg_area_name, c("prefecture"), sep = " ", remove = FALSE) # Seperating areas in function of their distance to "center"
# test <- hpg_store %>%
#   mutate(hpg_genre_name = as.factor(hpg_genre_name),
#          hpg_area_name = as.factor(hpg_area_name))
test <- hpg_store
med_coord_hpg <- hpg %>%
summarise_at(vars(longitude:latitude), median) # calculating median distance of all areas. (sort of center of japan)
hpg_coords <- hpg %>%
select(longitude, latitude) # just selecting coordinates
test$dist <- distCosine(hpg_coords, med_coord_hpg)/1e3 # creating a new column with distance btw each area and "center" of japan
test_count <- hpg_store %>%
group_by(hpg_area_name) %>%
summarise(hpg_count = n())
test <- test %>%
mutate(dist_group = as.integer(case_when(dist < 80 ~ 1, dist < 300 ~ 2, dist < 500 ~ 3, dist < 750 ~ 4, TRUE ~ 5))) %>%
left_join(test_count, by = "hpg_area_name") %>%
separate(hpg_area_name, c("prefecture"), sep = " ", remove = FALSE) # Seperating areas in function of their distance to "center"
p2 <- test %>%
ggplot(aes(dist)) +
geom_histogram(bins = 30, fill = "red") +
geom_vline(xintercept = c(80, 300, 500, 750)) +
labs(x = "Linear distance [km]")
p2
bar <- test %>%
select(latitude, longitude, dist_group) %>%
mutate(dset = "hpg")
leaflet(bar) %>%
addTiles() %>%
addProviderTiles("CartoDB.Positron") %>%
addScaleBar() %>%
addCircleMarkers(lng = bar$longitude, lat = bar$latitude, group = "HPG",
color = "red", fillOpacity = 0.5, radius = 3*bar$dist_group) %>%
addCircleMarkers(lng = med_coord_air$longitude, lat = med_coord_air$latitude, group = "Centre",
color = "darkgreen", fillOpacity = 1) %>%
addLayersControl(
overlayGroups = c("HPG", "Centre"),
options = layersControlOptions(collapsed = FALSE)
)
med_coord_hpg
leaflet(bar) %>%
addTiles() %>%
addProviderTiles("CartoDB.Positron") %>%
addScaleBar() %>%
addCircleMarkers(lng = bar$longitude, lat = bar$latitude, group = "HPG",
color = "red", fillOpacity = 0.5, radius = 3*bar$dist_group) %>%
addCircleMarkers(lng = med_coord_hpg$longitude, lat = med_coord_hpg$latitude, group = "Centre",
color = "darkgreen", fillOpacity = 1) %>%
addLayersControl(
overlayGroups = c("HPG", "Centre"),
options = layersControlOptions(collapsed = FALSE)
)
hpg_store %>%
ggplot(aes(prefecture)) +
geom_bar(fill = "red") +
coord_flip() +
ggtitle("hpg prefectures - # restaurants") +
labs(x = "")
test %>%
ggplot(aes(dist)) +
geom_histogram(bins = 30, fill = "red") +
geom_vline(xintercept = c(80, 300, 500, 750)) +
labs(x = "Linear distance [km]")
leaflet(bar) %>%
addTiles() %>%
addProviderTiles("CartoDB.Positron") %>%
addScaleBar() %>%
addCircleMarkers(lng = bar$longitude, lat = bar$latitude, group = "HPG",
color = "red", fillOpacity = 0.5, radius = 3*bar$dist_group) %>%
addCircleMarkers(lng = med_coord_hpg$longitude, lat = med_coord_hpg$latitude, group = "Centre",
color = "darkgreen", fillOpacity = 1) %>%
addLayersControl(
overlayGroups = c("HPG", "Centre"),
options = layersControlOptions(collapsed = FALSE)
)
leaflet(bar) %>%
addTiles() %>%
addProviderTiles("CartoDB.Positron") %>%
addScaleBar() %>%
addCircleMarkers(lng = bar$longitude, lat = bar$latitude, group = "HPG",
color = "red", fillOpacity = 0.5, radius = 3*bar$dist_group) %>%
addCircleMarkers(lng = med_coord_hpg$longitude, lat = med_coord_hpg$latitude, group = "Centre",
color = "darkgreen", fillOpacity = 1) %>%
addLayersControl(
overlayGroups = c("HPG", "Centre"),
options = layersControlOptions(collapsed = FALSE)
)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(naniar)
library(VIM)
library('geosphere') # geospatial locations
library('leaflet') # maps
library('leaflet.extras') # maps
library('maps') # maps
hpg_store <- read_csv("data/hpg_store_info.csv")
hpg_reserve <- read.csv("data/hpg_reserve.csv")
hpg_reserve <- hpg_reserve %>%
group_by(hpg_store_id) %>%
summarise(total = n())
knitr::opts_chunk$set(echo = TRUE)
submission_file <- read_csv("data/sample_submission.csv")
submission_file
submission_file %>%
mutate(date = substr(id, -10))
submission_file %>%
mutate(date = sub_str(id, -10))
submission_file %>%
mutate(date = sub_str(id, 0, -8))
submission_file %>%
mutate(date = sub_str(id, 0, 8))
submission_file %>%
mutate(date = substr(id, 0, -8))
submission_file %>%
mutate(date = substr(id, -8, -1))
submission_file %>%
mutate(date = substr(id, 8, 1))
submission_file %>%
mutate(date = substr(id))
submission_file %>%
mutate(date = substr(id, 0, 9))
submission_file %>%
mutate(date = substr(id, 0, 20))
submission_file %>%
mutate(date = substr(id, 0, 30))
submission_file %>%
mutate(date = substr(id, -31, -23))
submission_file %>%
mutate(date = substr(id, -23, -31))
submission_file %>%
mutate(date = substr(id, start = -23))
submission_file %>%
mutate(date = substr(id, start = -31, stop = -23))
submission_file %>%
mutate(date = substr(id, start = 23, stop = 31))
submission_file %>%
mutate(date = substr(id, start = 21, stop = 31))
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31))
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
group_by(id,date) %>%
distinct()
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 21))
group_by(id,date)
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 21))
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 21)) %>%
group_by(id,date) %>%
count()
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 21)) %>%
group_by(id,date) %>%
summarise(total =  n())
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 21)) %>%
group_by(id) %>%
summarise(total =  n())
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 20)) %>%
group_by(id) %>%
summarise(total =  n())
map("data/", read_csv())
my_files <- list.files("data", pattern = "csv", full.names = TRUE)
my_files <- my_files %>% map( data.table::fread, data.table = FALSE)
my_files <- my_files %>% map( data.table::fread)
library(purrr)
my_files <- my_files %>% map( data.table::fread, data.table = FALSE)
my_files <- my_files %>% map(read_csv)
data
my_files
my_files <- my_files %>% map(read_csv)
my_files <- my_files %>% map(data.table::fread, data.table = FALSE)
namespace::maps
install.packages("namespace")
my_files <- my_files %>% map(data.table::fread, data.table = FALSE)
namespace:maps
namespace::maps
my_files <- my_files %>% map(read.csv())
data <- read_csv(my_files)
data <- read_csv(c(my_files))
my_files <- my_files %>% map( data.table::fread, data.table = FALSE)
air_reserve <- read.csv("data/air_reserve.csv")
store_id_submission <- read.csv("data/store_id_relation.csv")
hpg_store_info <- read.csv("data/hpg_store_info.csv")
hpg_reserve <- read.csv("data/hpg_reserve.csv")
date_info <- read.csv("data/date_info.csv")
air_visit_data <- read.csv("data/air_visit_data.csv")
air_store_info <- read.csv("data/air_store_info.csv")
air_reserve <- read.csv("data/air_reserve.csv")
rm(store_id_submission)
hpg_reserve2 <- hpg_reserve %>%
mutate(visit_date = date(visit_datetime)) %>%
mutate(reserve_date = date(reserve_datetime))
hpg_reserve
hpg_reserve2 <- hpg_reserve %>%
mutate(visit_date = date(visit_datetime)) %>%
mutate(reserve_date = date(reserve_datetime))
hpg_reserve
View(hpg_reserve)
library(tidyverse)
hpg_reserve %>%
mutate(visit_date = date(visit_datetime)) %>%
mutate(reserve_date = date(reserve_datetime))
hpg_reserve$visit_datetime
hpg_reserve %>%
mutate(visit_date = date(visit_datetime))
library(lubridate)
library(purrr)
library(tidyverse)
air_visit_data <- read.csv("data/air_visit_data.csv")
air_store_info <- read.csv("data/air_store_info.csv")
air_reserve <- read.csv("data/air_reserve.csv")
# Hpg
hpg_store_info <- read.csv("data/hpg_store_info.csv")
hpg_reserve <- read.csv("data/hpg_reserve.csv")
# Date
date_info <- read.csv("data/date_info.csv")
submission_file <- read_csv("data/sample_submission.csv")
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 20)) %>%
group_by(id) %>%
summarise(total =  n())
knitr::opts_chunk$set(echo = TRUE)
library(purrr)
library(tidyverse)
library(lubridate)
submission_file <- read_csv("data/sample_submission.csv")
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 20)) %>%
group_by(id) %>%
summarise(total =  n())
# Air
air_visit_data <- read.csv("data/air_visit_data.csv")
air_store_info <- read.csv("data/air_store_info.csv")
air_reserve <- read.csv("data/air_reserve.csv")
# Hpg
hpg_store_info <- read.csv("data/hpg_store_info.csv")
hpg_reserve <- read.csv("data/hpg_reserve.csv")
# Date
date_info <- read.csv("data/date_info.csv")
hpg_reserve2 <- hpg_reserve %>%
mutate(visit_date = date(visit_datetime)) %>%
mutate(reserve_date = date(reserve_datetime))
hpg_reserve$visit_datetime
date_info <- date_info %>%
mutate(calendar_date = date(calendar_date))
date_info
hpg_reserve3 <- full_join(hpg_reserve2,date_info, by = c("visit_date"="calendar_date"))
hpg_reserve3
hpg_reserve3 %>% group_by(holiday_flg) %>% summarise(total= n())
date_info
levels(as.factor(date_info$calendar_date))
submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 20)) %>%
group_by(id) %>%
summarise(total =  n())
nrow(submission_file %>%
mutate(date = substr(id, start = 22, stop = 31)) %>%
mutate(id = substr(id, start = 0, stop = 20)) %>%
group_by(id) %>%
summarise(total =  n()))
date_info
hpg_reserve3 %>% group_by(holiday_flg) %>% summarise(total= n())
hpg_reserve3
hpg_reserve3 %>% group_by(hpg_store_id) %>% summarise(total = sum(holiday_flg))
date_info
hpg_reserve3
hpg_reserve2
date_info
hpg_reserve3
hpg_reserve3 %>% filter(visit_date == "2017-05-25")
hpg_store
hpg_store <- read.csv("data/hpg_store_info.csv")
hpg_store
rm(hpg_store_info)
hpg_store
%>%
hpg_reserve %>% distinct(hpg_store_id) %>% summarise(count = n())
hpg1 <- left_join(hpg_reserve,hpg_store, by = "hpg_store_id")
hpg1
sum(is.na(hpg1))
hpg1
hpg1 %>% group_by(hpg_store_id) %>% mutate(na = sum(is.na()))
hpg_store
sum(is.na(hpg1))/4 # since we have 4 variables in addition to id in store
hpg1 <- left_join(hpg_reserve3,"hpg_store", by = "hpg_store_id")
hpg_reserve3
hpg1 <- left_join(hpg_reserve,"hpg_store", by = "hpg_store_id")
hpg_reserve
left_join(hpg_reserve,"hpg_store", by = "hpg_store_id")
hpg2 <- left_join(hpg_reserve,"hpg_store", by = "hpg_store_id")
rm(hpd_reserve)
rm(hpg_reserve)
hpg_reserve <- read.csv("data/hpg_reserve.csv")
