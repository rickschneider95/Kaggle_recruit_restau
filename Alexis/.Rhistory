}
date_info
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
air_store_info <- read.csv("data/air_store_info.csv")
air_visit_data <- read.csv("data/air_visit_data.csv")
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
try <- air_data
# Transf functions on basic vars:
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try <- nth_day_trasnf(try)
try
try
test <- try  %>% group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
test
try <- try  %>% group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
try
try <- air_data
try <- nth_day_trasnf(try)
try
try <- air_data
try <- nth_day_trasnf(try)
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try
try <- try  %>% group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
try
try <- try[,-c(4:9)]
#CHANFE LAST NUMBER EVERY NEW VERSION:
write.csv(try, "data/data_1h_xgb_CORRECT_9.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_CORRECT_9.csv")
# Checks :
n_occur <- data.frame(table(trytry$id,trytry$visit_date))
n_occur[n_occur$Freq > 1,]  # No duplicates
summary(is.na(trytry)) # No NA's
sample_try <- read.csv("data/sample_submission.csv")
sample_try
sample_try <- read.csv("data/submission_data.csv.csv")
sample_try <- read.csv("data/submission_data.csv")
sample_try
sample_try
sample_try
levels(as.factor(sample_try$predict_date))
nth_day_trasnf_sub <- function(data){
days <- c(144:184)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
sample_try
sample_try <- read.csv("data/submission_data.csv") %>%
rename(visit_date = predict_date)
sample_try
nth_day_trasnf_sub <- function(data){
days <- c(144:184)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
sample_try <- nth_day_trasnf_sub(sample_try)
days <- c(144:184)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
sample_try <- nth_day_trasnf(sample_try)
sample_try <- vmonth_transf(try)
rm(try)
sample_try <- read.csv("data/submission_data.csv") %>%
rename(visit_date = predict_date)
sample_try <- nth_day_trasnf(sample_try)
sample_try <- vmonth_transf(sample_try)
sample_try <- vyear_transf(sample_try)
sample_try <- area_transf(sample_try)
sample_try <- genre_gr_transf(sample_try)
sample_try <- vdayweek_transf(sample_try)
sample_try
sample_try <- read.csv("data/submission_data.csv") %>%
rename(visit_date = predict_date) %>%
rename(day_of_the_week_visit = day_of_week)
sample_try <- nth_day_trasnf(sample_try)
sample_try <- vmonth_transf(sample_try)
sample_try <- vyear_transf(sample_try)
sample_try <- area_transf(sample_try)
sample_try <- genre_gr_transf(sample_try)
sample_try <- vdayweek_transf(sample_try)
sample_try <- bme_vmonth_transf(sample_try)
sample_try <- vholflg_transf(sample_try)
sample_try <- lat_transf(sample_try)
sample_try <- vholflg_transf(sample_try)
sample_try
sample_try <- read.csv("data/submission_data.csv") %>%
rename(visit_date = predict_date) %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg)
sample_try <- nth_day_trasnf(sample_try)
sample_try <- vmonth_transf(sample_try)
sample_try <- vyear_transf(sample_try)
sample_try <- area_transf(sample_try)
sample_try <- genre_gr_transf(sample_try)
sample_try <- vdayweek_transf(sample_try)
sample_try <- bme_vmonth_transf(sample_try)
sample_try <- vholflg_transf(sample_try)
sample_try <- lat_transf(sample_try)
sample_try <- lon_transf(sample_try)
sample_try <- goldd_transf(sample_try)
sample_try <- goldw_transf(sample_try)
sample_try <- barrest_transf(sample_try)
sample_try <- wknd_transf(sample_try)
sample_try <- wealth_transf(sample_try)
sample_try <- sample_try  %>% group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
sample_try
sample_try
sample_try <- sample_try[,-c(4:9)]
sample_try
#CHANFE LAST NUMBER EVERY NEW VERSION:
write.csv(sample_try, "data/data_1h_xgb_samplesubmission.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_samplesubmission.csv")
trytry
lag_transf <- function(data){
data <- data %>%
group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
}
try <- air_data
lag_transf <- function(data){
data <- data %>%
group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
}
try <- lag_transf(try)
try
