<<<<<<< HEAD
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = foliday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(data_air))
data_air
data_air <- data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
data_air
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg)
data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name,day_of_the_week_visit,holiday_flg_visit) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
vtime_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vtime_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vtime_transf <- function(data){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data <- data %>% cbind(one_h)
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
ryear_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 0, end = 4))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vyear_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 0, end = 4))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
basic_area_transf <- function(data){
one_h <- data
one_h <- data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = as.factor(case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name))) ## This is just an error in the data set
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
rdayweek_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vholflg_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(holiday_flg_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rholflg_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(holiday_flg_reserve)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
area_transf <- function(data){
one_h <- data
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
=======
rdayweek_transf <- function(data){
one_h <- data %>%
select(day_of_the_week_reserve) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data %>%
select(day_of_the_week_visit) %>% # Already factor
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data %>%
select(longitude) %>%
map(round, digits = 1) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data %>%
select(latitude) %>%
map(round, digits = 1) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
vholflg_transf <- function(data){
one_h <- data %>%
select(holiday_flg_visit) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
rholflg_transf <- function(data){
one_h <- data %>%
select(holiday_flg_reserve) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
genre_transf <- function(data){
one_h <- data %>%
select(genre_name) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
area_transf <- function(data){
one_h <- data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
map(str_sub, start = 0, end = 8) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
bme_vmonth_transf <- function(data){
one_h <- data %>%
select(visit_date) %>%
mutate(visit_date = as.character(str_sub(visit_date, start = 9, end = 10))) %>%
mutate(visit_date = as.factor(case_when(visit_date >= 0 & visit_date <= 12 ~ "beginning",
visit_date >= 13 & visit_date <= 22 ~ "middle",
TRUE ~ "end"))) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
genre_gr_transf <- function(data){
one_h <- data %>%
select(genre_name) %>%
mutate(genre_name = case_when(genre_name == "Izakaya" |
genre_name == "Okonomiyaki/Monja/Teppanyaki" |
genre_name == "Japanese food in general" |
genre_name == "Japanese cuisine/Kaiseki" ~ "Japanese food",
genre_name == "Italian/French" |
genre_name == "Italian" ~ "Western food",
genre_name == "Creative cuisine" |
genre_name == "Creative Japanese food" ~ "Creation",
genre_name == "Karaoke" |
genre_name == "Party" |
genre_name == "Karaoke/Party" ~ "Amusement bar",
genre_name == "Asian" ~ "Yakiniku/Korean food",
genre_name == "Cafe/Sweets" ~ "Cafe",
genre_name == "Steak/Hamburger/Curry" ~ "Grilled meat",
TRUE ~ as.character(genre_name))) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
barrest_transf <- function(data){
one_h <- data %>%
select(genre_name) %>%
mutate(genre_name = case_when(genre_name == "Asian" |
genre_name == "Okonomiyaki/Monja/Teppanyaki" |
genre_name == "Japanese food" |
genre_name == "Western food" |
genre_name == "Italian/French" |
genre_name == "International cuisine" |
genre_name == "Yakiniku/Korean food" |
genre_name == "Izakaya" |
genre_name == "Creative cuisine" ~ "Restaurant",
genre_name == "Dining bar" |
genre_name == "Bar/Cocktail" |
genre_name == "Karaoke/Party" |
genre_name == "Cafe/Sweets" ~ "Bar",
TRUE ~ "Else")) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
goldw_transf <- function(data){
one_h <- data %>%
mutate(visit_date = ymd(visit_date)) %>%
mutate(goldenweek = case_when(visit_date > ymd("20160428") & visit_date < ymd("20160507") ~ 1,
visit_date > ymd("20170428") & visit_date < ymd("20170507") ~ 1,
TRUE ~ 0)) %>%
select(goldenweek) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
goldd_transf <- function(data){
one_h <- data %>%
mutate(visit_date = ymd(visit_date)) %>%
mutate(goldendays = case_when(visit_date == ymd("20160429") |
visit_date == ymd("20160503") |
visit_date == ymd("20160504") |
visit_date == ymd("20160505") |
visit_date == ymd("20170429") |
visit_date == ymd("20170503") |
visit_date == ymd("20170504") |
visit_date == ymd("20170505") ~ 1,
TRUE ~ 0)) %>%
select(goldendays) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
wknd_transf <- function(data){
one_h <- data %>%
mutate(wknd = case_when(day_of_the_week_visit == "Friday" |
day_of_the_week_visit == "Saturday" |
day_of_the_week_visit == "Sunday" ~ "weekend",
TRUE ~ "weekday")) %>%
select(wknd) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
wealth_transf <- function(data){
one_h <- data %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = str_sub(area_name, start = 0, end = 8)) %>%
mutate(wealth = case_when(area_name == "Tōkyō-to" ~ "High",
area_name == "Shizuoka" | area_name == "Hyōgo-ke" | area_name == "Ōsaka-fu" ~ "Middle/High",
area_name == "Niigata-" | area_name == "Miyagi-k" | area_name == "Hokkaidō" ~ "Middle",
area_name == "Fukuoka-" ~ "Middle/Low",
TRUE ~ "Low")) %>%
select(wealth) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
nth_day_trasnf <- function(data){
days <- c(1:365,1:152)
dates <- date_info %>%
cbind(days) %>%
select(visit_date,days)
data <- data %>%
left_join(dates, by = "visit_date")
}
lag_transf <- function(data){
data <- data %>%
group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
}
dn_transf <- function(data){
one_h <- data %>%
select(visit_time) %>%
mutate(visit_time = as.integer(str_sub(as.character(visit_time),
start = 0,
end = 3))) %>%
mutate(visit_time = case_when(visit_time >= 4 & visit_time <= 16 ~ "noon",          # Lunch
TRUE ~ "night")) %>%    # Dinner
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
>>>>>>> b5723d574192c7115c01a24e3b4922f00cf6bd7d
latency_transf <- function(data){
one_h <- data
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 15 ~ "casual",
latency_days > 15 & latency_days <= 45 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
<<<<<<< HEAD
bme_vmonth_transf <- function(data){
one_h <- dataset
one_h$visit_date <- as.integer(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>%
select(visit_date) %>%
mutate(visit_date = as.factor(case_when(visit_date >= 0 & visit_date <= 12 ~ "beginning",
visit_date >= 13 & visit_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_rmonth_transf <- function(data){
one_h <- dataset
=======
bme_rmonth_transf <- function(data){
one_h <- data
>>>>>>> b5723d574192c7115c01a24e3b4922f00cf6bd7d
one_h$reserve_date <- as.integer(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>%
select(reserve_date) %>%
mutate(reserve_date = as.factor(case_when(reserve_date >= 0 & reserve_date <= 12 ~ "beginning",
reserve_date >= 13 & reserve_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
<<<<<<< HEAD
data_air
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(data_air))
data_air <- data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name,day_of_the_week_visit,holiday_flg_visit) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
data_air
try <- data_air
try
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try
rm(try)
data_air
try <- data_air
try <- vmonth_transf(try)
try
try <- vyear_transf(try)
try
try <- area_transf(try)
try
bme_rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.integer(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>%
select(reserve_date) %>%
mutate(reserve_date = as.factor(case_when(reserve_date >= 0 & reserve_date <= 12 ~ "beginning",
reserve_date >= 13 & reserve_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.integer(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>%
select(visit_date) %>%
mutate(visit_date = as.factor(case_when(visit_date >= 0 & visit_date <= 12 ~ "beginning",
visit_date >= 13 & visit_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try
try
try
try <- try[,-c(3:8)]
try
write.csv(try, "data/data_1h_xgb_improved.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
trytry %>% distinct(id,visit_date)
n_occur <- data.frame(c(trytry$id,trytry$visit_date))
n_occur[n_occur$Freq > 1,]
vocabulary[vocabulary$id %in% n_occur$Var1[n_occur$Freq > 1],]
n_occur[n_occur$Freq > 1,]
n_occur <- data.frame(table(trytry$id,trytry$visit_date))
n_occur[n_occur$Freq > 1,]
trytry
trytry %>% distinct(id,visit_date)
trytry
colSums(is.na.data.frame(trytry))
nrow(trytry)
rm(trytry)
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
data_air
try <- vmonth_transf(try)
try <- vyear_transf(try)
data_air
rm(try)
try <- data_air
=======
average_transf <- function(data){
one_h <- data %>%
mutate(av_per_day = round(visitors/nb_res)) %>%
select(av_per_day) %>%
map(as.factor) %>%
map(as.data.table) %>%
map(one_hot)
data <- data %>% cbind(one_h)
}
try <- air_data
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- genre_gr_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try <- nth_day_trasnf(try)
air_data
try <- nth_day_trasnf(try)
air_data
date_info <- fread("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
air_data <- read.csv("data/air_data.csv")
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
try <- air_data
# Transf functions on basic vars:
>>>>>>> b5723d574192c7115c01a24e3b4922f00cf6bd7d
try <- vmonth_transf(try)
try
try <- vyear_transf(try)
try
try <- area_transf(try)
try
try <- vdayweek_transf(try)
try
try <- bme_vmonth_transf(try)
try
try <- vholflg_transf(try)
<<<<<<< HEAD
try
try
try <- try[,-c(3:8)]
try
write.csv(try, "data/data_1h_xgb_improved.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
data_air
trytry
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
trytry
trytry
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
air_store_info <- read.csv("data/air_store_info.csv")
load("~/Desktop/Github/Kaggle_recruit_restau/Alexis/.RData")
air_store_info <- read.csv("data/air_store_info.csv")
air_visit_data <- read.csv("data/air_visit_data.csv")
air_data <- full_join(air_visit_data,air_store_info, by = "air_store_id") %>%
rename(id = air_store_id) %>%
rename(genre_name = air_genre_name) %>%
rename(area_name = air_area_name)
summary(is.na(air_data)) # No NA's.
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
air_data <- left_join(air_data,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(air_data)) # No NA's.
dataset <- read.csv("data/complete_data_final.csv")
knitr::opts_chunk$set(echo = TRUE)
library(leaflet)
air_store <- read_csv("data/air_store_info.csv")
names(air_data)
ids <- read.csv("data/store_id_relation.csv")
names(air_data)
names(complete_data)
complete_data <- read_csv(complete_data)
complete_data <- read_csv("data/complete_data")
complete_data <- read_csv("./data/complete_data")
complete_data <- read_csv("./data/complete_data.csv")
names(complete_data)
names(complete_data)
data_air <- data_air %>%
mutate(nb_res = 1) %>%
group_by(id,visit_date) %>%
mutate(nb_res = sum(nb_res))
dataset <- read.csv("data/complete_data_final.csv")
dataset <- read.csv("data/complete_data.csv")
library(data.table)
dataset <- read.csv("data/complete_data_final.csv")
dataset <- fread("data/complete_data_final.csv")
getwd()
dataset <- fread("data/complete_data.csv")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
library(purrr)
head(complete_data)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
library(purrr)
complete_data <- fread("./data/complete_data.csv")
names(complete_data)
air_store_info <- fread("data/air_store_info.csv")
air_visit_data <- fread("data/air_visit_data.csv")
air_data <- full_join(air_visit_data,air_store_info, by = "air_store_id") %>%
rename(id = air_store_id) %>%
rename(genre_name = air_genre_name) %>%
rename(area_name = air_area_name)
summary(is.na(air_data)) # No NA's.
#lines 70 a 109
#holiday 2 days before and 2 days after: 2
names(air_data)
air_store_info <- fread("data/air_store_info.csv")
air_visit_data <- fread("data/air_visit_data.csv")
air_data <- full_join(air_visit_data,air_store_info, by = "air_store_id") %>%
rename(id = air_store_id) %>%
rename(genre_name = air_genre_name) %>%
rename(area_name = air_area_name)
summary(is.na(air_data)) # No NA's.
date_info <- fread("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
air_data <- left_join(air_data,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(air_data)) # No NA's.
names(air_data)
#lines 70 a 109
#holiday 2 days before and 2 days after: 2
names(air_data)
head(air_data)
unique(holiday_flg_visit)
unique(air_data$holiday_flg_visit)
head(air_data)
head(air_data,100)
unique(air_data$genre_name)
air_data %>%
filter(genre_name=="Izakaya")
head(air_data,100)
#lines 70 a 109
#if holiday==1 then 2 days before and after transform to 2
library(dplyr)
air_data %>%
mutate(holiday_flg_visit = case_when(
lead(holiday_flg_visit)==1&holiday_flg_visit==0 ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&holiday_flg_visit==0 ~ 2,
lag(holiday_flg_visit,1)==1$holiday_flg_visit==0 ~ 2,
air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&holiday_flg_visit==0 ~ 2,
lag(holiday_flg_visit,1)==1$holiday_flg_visit==0 ~ 2,
air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2
))
unique(air_data)
unique(air_data$holiday_flg_visit)
test <- air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2
))
unique(test$holiday_flg_visit)
test <- air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&&(holiday_flg_visit==0) ~ 2
))
unique(test$holiday_flg_visit)
test <- air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2
))
unique(test$holiday_flg_visit)
test <- air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
TRUE ~ holiday_flg_visit
))
test <- air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
TRUE ~ as.numeric(holiday_flg_visit)
))
unique(test$holiday_flg_visit)
#if holiday==1 (there is a holiday) then 2 days before and after transform to 2, creating a new category to take the "holiday feels" effect into account
air_data <- air_data %>%
mutate(holiday_flg_visit = case_when(
(lead(holiday_flg_visit,1)==1)&(holiday_flg_visit==0) ~ 2, #if next row holiday_flg_visit has a certain value, and holiday flag visit has a normal value, then return 2.
lead(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,1)==1&(holiday_flg_visit==0) ~ 2,
lag(holiday_flg_visit,2)==1&(holiday_flg_visit==0) ~ 2,
TRUE ~ as.numeric(holiday_flg_visit)
))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(data.table)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
library(purrr)
names(air_data)
names(air_data)
typesRest <- unique(air_data$genre_name)
typesRest
unique(air_data$genre_name)
unique(complete_data$genre_name)
=======
try <- lat_transf(try)
try <- lon_transf(try)
try <- goldd_transf(try)
try <- goldw_transf(try)
try <- barrest_transf(try)
try <- wknd_transf(try)
try <- wealth_transf(try)
try <- lag_transf(try)
try
try <- lag_transf(try)
try <- lag_transf(try)
try <- try %>%
group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
library(RcppRoll)
library(zoo)
lag_transf <- function(data){
data <- data %>%
group_by(id) %>%
mutate(lag_1 = lag(visitors, 1),
lag_2 = lag(visitors, 2),
lag_3 = lag(visitors, 3),
lag_4 = lag(visitors, 4),
lag_5 = lag(visitors, 5),
lag_6 = lag(visitors, 6),
lag_7 = lag(visitors, 7),
lag_8 = lag(visitors, 8),
lag_9 = lag(visitors, 9),
lag_10 = lag(visitors, 10),
lag_11 = lag(visitors, 11),
lag_12 = lag(visitors, 12),
lag_13 = lag(visitors, 13),
lag_14 = lag(visitors, 14),
lag_15 = lag(visitors, 15),
lag_16 = lag(visitors, 16),
lag_17 = lag(visitors, 17),
lag_18 = lag(visitors, 18),
lag_19 = lag(visitors, 19),
lag_20 = lag(visitors, 20),
lag_21 = lag(visitors, 21),
lag_22 = lag(visitors, 22),
lag_23 = lag(visitors, 23),
lag_24 = lag(visitors, 24),
lag_25 = lag(visitors, 25),
lag_26 = lag(visitors, 26),
lag_27 = lag(visitors, 27),
lag_28 = lag(visitors, 28),
lag_30 = lag(visitors, 30),
lag_33 = lag(visitors, 33),
lag_36 = lag(visitors, 36),
lag_39 = lag(visitors, 39),
lag_40 = lag(visitors, 40),
lag_50 = lag(visitors, 50),
lag_60 = lag(visitors, 60),
lag_70 = lag(visitors, 70),
lag_80 = lag(visitors, 80),
lag_90 = lag(visitors, 90),
lag_100 = lag(visitors, 100),
lag_120 = lag(visitors, 120),
lag_150 = lag(visitors, 150),
lag_180 = lag(visitors, 180),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_3 = lag(roll_meanr(visitors, 3), 1),
avg_7 = lag(roll_meanr(visitors, 7), 1),
avg_14 = lag(roll_meanr(visitors, 14), 1),
avg_21 = lag(roll_meanr(visitors, 21), 1),
avg_28 = lag(roll_meanr(visitors, 28), 1),
avg_50 = lag(roll_meanr(visitors, 50), 1),
avg_100 = lag(roll_meanr(visitors, 100), 1),
avg_150 = lag(roll_meanr(visitors, 150), 1),
avg_200 = lag(roll_meanr(visitors, 200), 1),
avg_250 = lag(roll_meanr(visitors, 250), 1),
avg_300 = lag(roll_meanr(visitors, 300), 1)
)
}
try
try <- lag_transf(try)
try
try <- nth_day_trasnf(try)
try
sample_try <- read.csv("data/submission_data.csv") %>%
rename(visit_date = predict_date) %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg)
sample_try
sample_try <- nth_day_trasnf(sample_try)
sample_try
sample_try <- vmonth_transf(sample_try)
sample_try
sample_try <- vyear_transf(sample_try)
sample_try
sample_try
sample_try <- area_transf(sample_try)
sample_try
sample_try <- genre_gr_transf(sample_try)
sample_try
sample_try <- vdayweek_transf(sample_try)
sample_try
sample_try <- bme_vmonth_transf(sample_try)
sample_try
sample_try <- vholflg_transf(sample_try)
sample_try
sample_try <- lat_transf(sample_try)
sample_try
sample_try <- lon_transf(sample_try)
sample_try
sample_try <- goldd_transf(sample_try)
sample_try
sample_try <- goldw_transf(sample_try)
sample_try
sample_try <- barrest_transf(sample_try)
sample_try
sample_try <- wknd_transf(sample_try)
sample_try
sample_try <- wealth_transf(sample_try)
sample_try
ssample_try <- lag_transf(sample_try)
ssample_try
try
try %>% select(starts_with("lag"))
lags <- try %>% select(starts_with("lag"))
lags
lags <- try %>% select(starts_with("lag"),visit_date)
lags
lags <- try %>% select(id,visit_date,starts_with("lag"))
lags
write_csv(lags,"lags.csv",row.names = FALSE)
write_csv(lags,"data/lags.csv",row.names = FALSE)
write.csv(lags,"data/lags.csv",row.names = FALSE)
read.csv("data/lags.csv")
>>>>>>> b5723d574192c7115c01a24e3b4922f00cf6bd7d
