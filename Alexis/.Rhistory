one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
one_h
data %>% cbind(one_h)
data
try <- time_transf(data,visit_time)
try
time_transf <- function(data,column){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- time_transf(data,visit_time)
try
sum(is.na(data$day_of_the_week_reserve))
data
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
time_transf <- function(data,column){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
dataset <- read.csv("data/complete_data.csv")
data <- dataset %>% filter(str_detect(id, "^air"))
data_air <- dataset %>% filter(str_detect(id, "^air"))
rm(data)
time_transf <- function(data,column){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- data_air
try <- time_transf(try)
try
rm(try)
data_hpg
data_air
time_transf <- function(data,column){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
time_transf <- function(data,column){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vtime_transf <- function(data,column){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rtime_transf <- function(data,column){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try,reserve_time)
try
try <- vtime_transf(try,visit_time)
try
data_air
as.factor(str_sub(as.character(one_h$reserve_date), start = 0, end = 3))
one_h$reserve_date
as.factor(str_sub(as.character(data_air$reserve_date), start = 0, end = 3))
data_air$reserve_date
as.factor(str_sub(as.character(data_air$reserve_date), start = 6, end = 7))
dataset
vmonth_transf <- function(data,column){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try,reserve_time)
try <- vtime_transf(try,visit_time)
try <- vmonth_transf(try,visit_time)
try
vmonth_transf <- function(data,column){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vmonth_transf <- function(data,column){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rmonth_transf <- function(data,column){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vmonth_transf <- function(data,column){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rm(try)
try <- data_air
try <- rtime_transf(try,reserve_time)
try <- vtime_transf(try,visit_time)
try <- rmonth_transf(try,visit_time)
try <- vmonth_transf(try,visit_time)
try
as.factor(str_sub(as.character(data_air$visit_date), start = 0, end = 4))
ryear_transf <- function(data,column){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 0, end = 4))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vyear_transf <- function(data,column){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 0, end = 4))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try,reserve_time)
try <- vtime_transf(try,visit_time)
try <- rmonth_transf(try,visit_time)
try <- vmonth_transf(try,visit_time)
try <- ryear_transf(try,visit_time)
try <- vyear_transf(try,visit_time)
try
try
data_air
knitr::opts_chunk$set(echo = TRUE)
levels(as.factor(hpg$hpg_area_name)) # These are all the different areas in our data, although I'll group them according to the major city they are attached to.
levels(as.factor(hpg_reserve$hpg_area_name)) # These are all the different areas in our data, although I'll group them according to the major city they are attached to.
levels(as.factor(hpg_store_info$hpg_area_name)) # These are all the different areas in our data, although I'll group them according to the major city they are attached to.
hpg %>% mutate(hpg_area_name = substr(hpg_area_name, 0, 8))
hpg_store_info %>% mutate(hpg_area_name = substr(hpg_area_name, 0, 8))
data_air
data_t <- data_air
data_t <- data_t %>%
select(area_name)
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name))
data_t %>%
select(area_name) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name))
data_t %>%
select(area_name) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name))
data_t %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>%
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- data_air
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>%
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data_air %>% cbind(one_h)
try
area_transf <- function(data){
one_h <- data
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>%
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
area_transf <- function(data){
one_h <- data
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>%
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try
data_air
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3))) %>%
if (period == "noon"){
filter(visit_time <= 16 && visit_time >= 4)
} else {
filter(visit_time >= 16 && visit_time <= 4)
}
}
try <- data_air
n_d(try,"noon")
n_d(try,noon)
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3))) %>%
if (period == noon){
filter(visit_time <= 16 && visit_time >= 4)
} else {
filter(visit_time >= 16 && visit_time <= 4)
}
}
n_d(try,noon)
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3))) %>%
if (period = "noon"){
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3))) %>%
if (period == "noon"){
filter(visit_time <= 16 && visit_time >= 4)
} else {
filter(visit_time >= 16 && visit_time <= 4)
}
}
n_d(try,"noon")
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3))) %>%
if (as.character(period )== "noon"){
filter(visit_time <= 16 && visit_time >= 4)
} else {
filter(visit_time >= 16 && visit_time <= 4)
}
}
n_d(try,"noon")
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3))) %>%
if (as.character(period) == "noon"){
data <- data %>% filter(visit_time <= 16 && visit_time >= 4)
} else {
data <- data %>% filter(visit_time >= 16 && visit_time <= 4)
}
}
n_d(try,"noon")
ifelse(5==5,"yes","no")
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.factor(str_sub(as.character(visit_time), start = 0, end = 3)))
ifelse(as.character(period) == "noon",
data <- data %>% filter(visit_time <= 16 && visit_time >= 4),
data <- data %>% filter(visit_time >= 16 && visit_time <= 4)
)
}
n_d(try,"noon")
n_d <- function(data,period){
data <- data %>%
mutate(visit_time = as.numeric(str_sub(as.character(visit_time), start = 0, end = 3)))
ifelse(as.character(period) == "noon",
data <- data %>% filter(visit_time <= 16 && visit_time >= 4),
data <- data %>% filter(visit_time >= 16 && visit_time <= 4)
)
}
n_d(try,"noon")
try <- n_d(try,"noon")
try
try <- data_air
data_air
try <- data_air
try <- try %>%
mutate(visit_time = as.numeric(str_sub(as.character(visit_time), start = 0, end = 3)))
try
try <- try %>%
mutate(visit_time = as.numeric(str_sub(as.character(visit_time), start = 0, end = 3)))
ifelse(as.character(period) == "noon",
data <- data %>% filter(visit_time <= 16 && visit_time >= 4),
data <- data %>% filter(visit_time >= 16 && visit_time <= 4)
)
n_d <- function(data,period){
try <- data
try <- try %>%
mutate(visit_time = as.numeric(str_sub(as.character(visit_time), start = 0, end = 3)))
ifelse(as.character(period) == "noon",
data <- data %>% filter(visit_time <= 16 && visit_time >= 4),
data <- data %>% filter(visit_time >= 16 && visit_time <= 4)
)
}
n_d(try,"noon")
data_air
data_air %>% group_by(id,visit_date) %>% summarise(total = n())
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
data_air %>% group_by(id,visit_date) %>% summarise(total = n())
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
data_air
rdayweek_transf <- function(data){
one_h <- data
one_h$day_of_the_week_reserve <- as.factor(one_h$day_of_the_week_visit)
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data
one_h$day_of_the_week_visit <- as.factor(one_h$day_of_the_week_visit)
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- rdayweek_transf(try)
try <- vdayweek_transf(try)
try
data_air
data_air
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
try <- vtime_transf(try)
try <- rmonth_transf(try)
try <- vmonth_transf(try)
try <- ryear_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- rdayweek_transf(try)
try <- vdayweek_transf(try)
try <- lat_transf(try)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
one_h <- data_air
dataset <- read.csv("data/complete_data.csv")
data_air <- dataset %>% filter(str_detect(id, "^air"))
data_air
one_h <- data_air
one_h <- data_air
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
try <- data_air
try <- try %>% cbind(one_h)
try
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try <- data_air
try <- rtime_transf(try)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
dataset <- read.csv("data/complete_data.csv")
data_air <- dataset %>% filter(str_detect(id, "^air"))
data_hpg <- data %>% filter(str_detect(id, "^hpg"))
data_hpg <- data %>% filter(str_detect(id, "^hpg"))
data_hpg <- data set%>% filter(str_detect(id, "^hpg"))
data_hpg <- dataset %>% filter(str_detect(id, "^hpg"))
sum(is.na(data_air %>% group_by(id,visit_date) %>% summarise(total = n())))
vtime_transf <- function(data){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3)) #put visit_time as factor, and only extract the hour for the time: the first two components of the time: ex 19:00:00 will be converted to 19
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data <- data %>%
mutate(day_visit = day(dmy(visit_date)), #extract visit day from date
day_reserve = day(dmy(reserve_date)),  #extract reserve day from date
month_visit = month(dmy(visit_date)),   #extract visit month from date
month_reserve = month(dmy(reserve_date)), #extract reserve month from date
year_visit = year(dmy(visit_date)), #extract visit year from date
year_reserve = year(dmy(visit_date)), #extract reserve year from date
latency_days=ifelse(is.na(reserve_date),0,as.numeric(as.Date(visit_date)-as.Date(reserve_date))), #days between reservation vs visit. if no reservation then will be 0
latency_people=ifelse(is.na(reserve_visitors),0,visitors-reserve_visitors)) #difference in the number of people from the party between reservation vs visit. if no reservation then will be 0
vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
datal <- dataset %>%
mutate(day_visit = day(dmy(visit_date)), #extract visit day from date
day_reserve = day(dmy(reserve_date)),  #extract reserve day from date
month_visit = month(dmy(visit_date)),   #extract visit month from date
month_reserve = month(dmy(reserve_date)), #extract reserve month from date
year_visit = year(dmy(visit_date)), #extract visit year from date
year_reserve = year(dmy(visit_date)), #extract reserve year from date
latency_days=ifelse(is.na(reserve_date),0,as.numeric(as.Date(visit_date)-as.Date(reserve_date))), #days between reservation vs visit. if no reservation then will be 0
latency_people=ifelse(is.na(reserve_visitors),0,visitors-reserve_visitors)) #difference in the number of people from the party between reservation vs visit. if no reservation then will be 0
