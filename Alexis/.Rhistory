one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
area_transf <- function(data){
one_h <- data
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
latency_transf <- function(data){
one_h <- data
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 15 ~ "casual",
latency_days > 15 & latency_days <= 45 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_vmonth_transf <- function(data){
one_h <- dataset
one_h$visit_date <- as.integer(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>%
select(visit_date) %>%
mutate(visit_date = as.factor(case_when(visit_date >= 0 & visit_date <= 12 ~ "beginning",
visit_date >= 13 & visit_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_rmonth_transf <- function(data){
one_h <- dataset
one_h$reserve_date <- as.integer(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>%
select(reserve_date) %>%
mutate(reserve_date = as.factor(case_when(reserve_date >= 0 & reserve_date <= 12 ~ "beginning",
reserve_date >= 13 & reserve_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data_air
try <- data_air
try <- vmonth_transf(try)
try
try <- vyear_transf(try)
try
try <- area_transf(try)
try
try <- vdayweek_transf(try)
try
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
summary(is.na(data_air))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
date_info
data_air <- inner_join(data_air,date_info,by="visit_date") # CAREFULL, here it's an inner join, some days there were just no restaurants open :)
data_air
summary(is.na(data_air))
data_air
dataset
data_air
dataset %>% rename(day_of_the_week_visit = day_of_week)
dataset
vdayweek_transf <- function(data){
one_h <- dataset %>% rename(day_of_week = day_of_the_week_visit)
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
one_h <- data %>% rename(day_of_week = day_of_the_week_visit)
one_h <- data_air %>% rename(day_of_the_week_visit = day_of_week)
one_h
vdayweek_transf <- function(data){
one_h <- data_air %>% rename(day_of_the_week_visit = day_of_week) # modified to stick with the function!
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data %>% rename(day_of_the_week_visit = day_of_week) # modified to stick with the function!
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data_air
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
summary(is.na(data_air))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) # CAREFULL, here it's an inner join, some days there were just no restaurants open :)
data_air
data_air <- data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
dataset
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
summary(is.na(data_air))
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
summary(is.na(data_air))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = foliday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(data_air))
data_air
data_air <- data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
data_air
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg)
data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name,day_of_the_week_visit,holiday_flg_visit) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
vtime_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vtime_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vtime_transf <- function(data){
one_h <- data
one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
one_h <- one_h %>% select(visit_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data <- data %>% cbind(one_h)
rtime_transf <- function(data){
one_h <- data
one_h$reserve_time <- as.factor(str_sub(as.character(one_h$reserve_time), start = 0, end = 3))
one_h <- one_h %>% select(reserve_time)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 6, end = 7))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 6, end = 7))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
ryear_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.factor(str_sub(as.character(one_h$reserve_date), start = 0, end = 4))
one_h <- one_h %>% select(reserve_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vyear_transf <- function(data){
one_h <- data
one_h$visit_date <- as.factor(str_sub(as.character(one_h$visit_date), start = 0, end = 4))
one_h <- one_h %>% select(visit_date)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
basic_area_transf <- function(data){
one_h <- data
one_h <- data %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = as.factor(case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name))) ## This is just an error in the data set
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
rdayweek_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vdayweek_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(day_of_the_week_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lat_transf <- function(data){
one_h <- data
one_h$latitude <- as.factor(one_h$latitude)
one_h <- one_h %>% select(latitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
lon_transf <- function(data){
one_h <- data
one_h$longitude <- as.factor(str_sub(as.character(one_h$longitude), start = 0, end = 4))
one_h <- one_h %>% select(longitude)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
vholflg_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(holiday_flg_visit)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
rholflg_transf <- function(data){
one_h <- data
one_h <- one_h %>% select(holiday_flg_reserve)
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
area_transf <- function(data){
one_h <- data
one_h <- one_h %>%
select(area_name) %>%
mutate(area_name = as.character(area_name)) %>%
mutate(area_name = case_when(area_name == "Osaka Prefecture Osaka None" ~ "Ōsaka-fu Prefecture Osaka None",
TRUE ~ area_name)) %>% # error in the data
mutate(area_name = as.factor(substr(area_name, 0, 8)))
one_h <- one_hot(as.data.table(one_h))
try <- data %>% cbind(one_h)
}
latency_transf <- function(data){
one_h <- data
one_h <- one_h %>%
mutate(latency_days = as.integer(ifelse(is.na(reserve_date), 0, as.numeric(as.Date(visit_date) - as.Date(reserve_date))))) %>%
select(latency_days) %>%
mutate(latency_days = as.factor(case_when(latency_days >= 0 & latency_days <= 15 ~ "casual",
latency_days > 15 & latency_days <= 45 ~ "fancy",
TRUE ~ "very fancy")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_vmonth_transf <- function(data){
one_h <- dataset
one_h$visit_date <- as.integer(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>%
select(visit_date) %>%
mutate(visit_date = as.factor(case_when(visit_date >= 0 & visit_date <= 12 ~ "beginning",
visit_date >= 13 & visit_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_rmonth_transf <- function(data){
one_h <- dataset
one_h$reserve_date <- as.integer(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>%
select(reserve_date) %>%
mutate(reserve_date = as.factor(case_when(reserve_date >= 0 & reserve_date <= 12 ~ "beginning",
reserve_date >= 13 & reserve_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
data_air
data_air <- dataset %>%
filter(str_detect(id, "^air")) %>%
filter(visitors != "NA") %>%
select(-c(holiday_flg_visit,day_of_the_week_visit)) %>%  # I unselect these since they aren't correct
select(-c(visit_time,reserve_date,reserve_time,reserve_visitors,day_of_the_week_reserve,holiday_flg_reserve)) # Can't use these as long as we don't have the method to implement them in time series
data_air <- data_air %>%
group_by(id) %>%
fill(c(genre_name,area_name,latitude,longitude))
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
data_air <- inner_join(data_air,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(data_air))
data_air <- data_air %>%
group_by(id,visit_date,genre_name,latitude,longitude,area_name,day_of_the_week_visit,holiday_flg_visit) %>%
summarise(visitors = sum(visitors)) %>%
ungroup()
summary(is.na(data_air))
data_air
try <- data_air
try
try <- vmonth_transf(try)
try <- vyear_transf(try)
try <- area_transf(try)
try <- vdayweek_transf(try)
try <- bme_vmonth_transf(try)
try
rm(try)
data_air
try <- data_air
try <- vmonth_transf(try)
try
try <- vyear_transf(try)
try
try <- area_transf(try)
try
bme_rmonth_transf <- function(data){
one_h <- data
one_h$reserve_date <- as.integer(str_sub(as.character(one_h$reserve_date), start = 9, end = 10))
one_h <- one_h %>%
select(reserve_date) %>%
mutate(reserve_date = as.factor(case_when(reserve_date >= 0 & reserve_date <= 12 ~ "beginning",
reserve_date >= 13 & reserve_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
bme_vmonth_transf <- function(data){
one_h <- data
one_h$visit_date <- as.integer(str_sub(as.character(one_h$visit_date), start = 9, end = 10))
one_h <- one_h %>%
select(visit_date) %>%
mutate(visit_date = as.factor(case_when(visit_date >= 0 & visit_date <= 12 ~ "beginning",
visit_date >= 13 & visit_date <= 22 ~ "middle",
TRUE ~ "end")))
one_h <- one_hot(as.data.table(one_h))
data <- data %>% cbind(one_h)
}
try
try <- bme_vmonth_transf(try)
try <- vholflg_transf(try)
try
try
try
try <- try[,-c(3:8)]
try
write.csv(try, "data/data_1h_xgb_improved.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
trytry %>% distinct(id,visit_date)
n_occur <- data.frame(c(trytry$id,trytry$visit_date))
n_occur[n_occur$Freq > 1,]
vocabulary[vocabulary$id %in% n_occur$Var1[n_occur$Freq > 1],]
n_occur[n_occur$Freq > 1,]
n_occur <- data.frame(table(trytry$id,trytry$visit_date))
n_occur[n_occur$Freq > 1,]
trytry
trytry %>% distinct(id,visit_date)
trytry
colSums(is.na.data.frame(trytry))
nrow(trytry)
rm(trytry)
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
data_air
try <- vmonth_transf(try)
try <- vyear_transf(try)
data_air
rm(try)
try <- data_air
try <- vmonth_transf(try)
try
try <- vyear_transf(try)
try
try <- area_transf(try)
try
try <- vdayweek_transf(try)
try
try <- bme_vmonth_transf(try)
try
try <- vholflg_transf(try)
try
try
try <- try[,-c(3:8)]
try
write.csv(try, "data/data_1h_xgb_improved.csv", row.names = FALSE)
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
data_air
trytry
trytry <- read.csv("data/data_1h_xgb_improved.csv")
trytry
trytry
trytry
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
air_store_info <- read.csv("data/air_store_info.csv")
load("~/Desktop/Github/Kaggle_recruit_restau/Alexis/.RData")
air_store_info <- read.csv("data/air_store_info.csv")
air_visit_data <- read.csv("data/air_visit_data.csv")
air_data <- full_join(air_visit_data,air_store_info, by = "air_store_id") %>%
rename(id = air_store_id) %>%
rename(genre_name = air_genre_name) %>%
rename(area_name = air_area_name)
summary(is.na(air_data)) # No NA's.
date_info <- read.csv("data/date_info.csv")
date_info <- date_info %>%
rename(visit_date = calendar_date)
air_data <- left_join(air_data,date_info,by="visit_date") %>%
rename(day_of_the_week_visit = day_of_week) %>%
rename(holiday_flg_visit = holiday_flg) # CAREFULL, here it's an inner join, some days there were just no restaurants open
summary(is.na(air_data)) # No NA's.
dataset <- read.csv("data/complete_data_final.csv")
knitr::opts_chunk$set(echo = TRUE)
library(leaflet)
air_store <- read_csv("data/air_store_info.csv")
names(air_data)
ids <- read.csv("data/store_id_relation.csv")
names(air_data)
names(complete_data)
complete_data <- read_csv(complete_data)
complete_data <- read_csv("data/complete_data")
complete_data <- read_csv("./data/complete_data")
complete_data <- read_csv("./data/complete_data.csv")
names(complete_data)
names(complete_data)
data_air <- data_air %>%
mutate(nb_res = 1) %>%
group_by(id,visit_date) %>%
mutate(nb_res = sum(nb_res))
dataset <- read.csv("data/complete_data_final.csv")
dataset <- read.csv("data/complete_data.csv")
library(data.table)
dataset <- read.csv("data/complete_data_final.csv")
dataset <- fread("data/complete_data_final.csv")
getwd()
dataset <- fread("data/complete_data.csv")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
library(dplyr)
library(stringr)
library(lubridate)
library(caret)
library(purrr)
head(complete_data)
