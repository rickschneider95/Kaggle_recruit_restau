---
title: "format_data_xgb"
author: "Alexis Laks"
date: "29/11/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(onehot)
library(data.table)
library(mltools)
install.packages("mltools")
library(dplyr)
library(stringr)
library(lubridate)
```

This file will be dedicated to formatting the complete_data.csv file to feed to the xgb model.


# Keeping only hpg <-> air and air:

```{r}
dataset <- read.csv("data/complete_data.csv")
```


```{r}
data <- dataset %>% filter(str_detect(id, "^air"))
```

```{r}
data_hpg <- data %>% filter(str_detect(id, "^hpg"))
```


# One hot encoding for VISIT time:

```{r}
time_transf <- function(data,column){
  one_h <- data
  one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
  one_h <- one_h %>% select(visit_time)
  one_h <- one_hot(as.data.table(one_h))
  data <- data %>% cbind(one_h)
}

some_date <- c("01/02/1979", "03/04/1980")
day(dmy(some_date))


data <- data %>%
  mutate(day_visit = day(dmy(visit_date)),
         day_reserve = day(dmy(reserve_date)),
         month_visit = month(dmy(visit_date)),
         month_reserve = month(dmy(reserve_date)),
         year_visit = year(dmy(visit_date)),
         year_reserve = year(dmy(visit_date)))
```

# One hot encoding for RESERVE time:

```{r}
time_transf <- function(data,column){
  one_h <- data
  one_h$visit_time <- as.factor(str_sub(as.character(one_h$visit_time), start = 0, end = 3))
  one_h <- one_h %>% select(visit_time)
  one_h <- one_hot(as.data.table(one_h))
  data <- data %>% cbind(one_h)
}
```



We have NA's for day of the week reserve and day of the week visit
```{r}
sum(is.na(data$day_of_the_week_reserve))
sum(is.na(data$day_of_the_week_visit))
```
