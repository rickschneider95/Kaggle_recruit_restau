---
title: "Data_formatting"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
```

```{r}
rm(list=ls())  
df <- read.csv("data/complete_data.csv",encoding="UTF-8")
head(df)
```


```{r}

library(prenoms)
prenoms <-prenoms


```

```{r}
 dataset <- eventReactive(input$refresh,{
    
    prenoms_france %>%
      filter(name == input$name, sex %in% input$sex) %>%
      group_by(year, name) %>%
      summarise(total = sum(n)) %>%
      ungroup() %>%
      complete(year = 1900:2017, name, fill = list(total = 0))
    
  })
  
  
  library(prenoms)
  library(tidyverse)
  data(prenoms)
  
  draw_a_name <- function(nom,data) {
   data %>% 
      # replace_na(list(total = 0)) %>%
      ggplot() +
      aes(x = year, y = total) +
      geom_line(col=input$color)+
      coord_cartesian(xlim=input$year_period)
  }
  
  general_overview <- function(df,time){
    df %>%
    group_by(time) %>%
    summarise(total=sum(visitors)) %>%
    ggplot()+
    aes(x = year, y = total) +
    geom_line(col=input$color)+
  }
```

```{r}
library(RColorBrewer)
general_overview <- function(df,time){
      quo_time <- enquo(time)
      str_time <- quo_name(quo_time)
      
      df %>%
      filter(!is.na(!!quo_time)) %>% 
      filter(!is.na(visitors)) %>% 
      group_by(!!quo_time) %>%
      summarise(total=sum(visitors)) %>% 
      
      ggplot(aes_string(x =str_time, y = "total",fill=str_time))+
      geom_bar(stat='identity')+
      theme(axis.text.x = element_text(angle = 90, vjust = 0.5),legend.position = "none")
      
}

general_overview(df,day_of_the_week_visit)


 df %>%
      filter(!is.na(visit_time),!is.na(visitors)) %>% 
      group_by(visit_time) %>%
      summarise(total=sum(visitors)) %>%
      ggplot()+
      aes(x =visit_time, y = total) +
      geom_point()



 
 
```

```{r}
library(leaflet)

leaflet(df %>% distinct(id, .keep_all = TRUE)) %>%
  addTiles() %>%
  addProviderTiles("CartoDB.Positron") %>%
  addMarkers(~longitude, ~latitude,
             popup = ~id, label = ~genre_name,
              clusterOptions = markerClusterOptions())


```

